---
apiVersion: v1
kind: ConfigMap
metadata:
 name: telegraf-config
 namespace: telegraf
data:
 telegraf.conf: |
  [global_tags]
  # Add any global tags here
  [agent]
  interval = "10s" # Adjust the interval as per your requirements
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = ""
  hostname = ""
  omit_hostname = true

  # # Retrieves SNMP values from remote agents
  [[inputs.snmp]]
  #   ## Agent addresses to retrieve values from.
  #   ##   format:  agents = ["<scheme://><hostname>:<port>"]
  #   ##   scheme:  optional, either udp, udp4, udp6, tcp, tcp4, tcp6. Default is udp
  #   ##   port:    optional
     #agents = ["10.100.5.2","10.100.5.3","10.100.5.4","10.100.5.5","10.100.5.6","10.100.5.7","10.100.5.8","10.100.5.9","10.100.5.10","10.100.5.11","10.100.5.12","10.100.5.13","10.100.5.14","10.100.5.15","10.100.5.16","10.100.5.17","10.100.5.18","10.100.5.19","10.100.5.20","10.100.5.21","10.100.5.22","10.100.5.23","10.100.5.24","10.100.5.25","10.100.5.26","10.100.5.27","10.100.5.28","10.100.5.29","10.100.5.30","10.100.5.31","10.100.5.32","10.100.5.33","10.100.5.34","10.100.5.35","10.100.5.36","10.100.5.37","10.100.5.38","10.100.5.39","10.100.5.40","10.100.5.41","10.100.5.42","10.100.5.43","10.100.5.44","10.100.5.45","10.100.5.46","10.100.5.47","10.100.5.48","10.100.5.49","10.100.5.50","10.100.5.51","10.100.5.52","10.100.5.53","10.100.5.54","10.100.5.55","10.100.5.56","10.100.5.57","10.100.5.58","10.100.5.59","10.100.5.60","10.100.5.61","10.100.5.62","10.100.5.63","10.100.5.64","10.100.5.65","10.100.5.66","10.100.5.67","10.100.5.68","10.100.5.69","10.100.5.70","10.100.5.71","10.100.5.72","10.100.5.73","10.100.5.74","10.100.5.75","10.100.5.76","10.100.5.77","10.100.5.78","10.100.5.79","10.100.5.80","10.100.5.81","10.100.5.82","10.100.5.83","10.100.5.84","10.100.5.85","10.100.5.86","10.100.5.87","10.100.5.88","10.100.5.89","10.100.5.90","10.100.5.91","10.100.5.92","10.100.5.93","10.100.5.94","10.100.5.95","10.100.5.96","10.100.5.97","10.100.5.98","10.100.5.99","10.100.5.100","10.100.5.101","10.100.5.102","10.100.5.103","10.100.5.104","10.100.5.105","10.100.5.106","10.100.5.107","10.100.5.108","10.100.5.109","10.100.5.110","10.100.5.111","10.100.5.112","10.100.5.113","10.100.5.114","10.100.5.115","10.100.5.116","10.100.5.117","10.100.5.118","10.100.5.119","10.100.5.120","10.100.5.121","10.100.5.122","10.100.5.123","10.100.5.124","10.100.5.125","10.100.5.126","10.100.5.127","10.100.5.128","10.100.5.129","10.100.5.130","10.100.5.131","10.100.5.132","10.100.5.133","10.100.5.134","10.100.5.135","10.100.5.136","10.100.5.137","10.100.5.138","10.100.5.139","10.100.5.140","10.100.5.141","10.100.5.142","10.100.5.143","10.100.5.144","10.100.5.145","10.100.5.146","10.100.5.147","10.100.5.148","10.100.5.149","10.100.5.150","10.100.5.151","10.100.5.152","10.100.5.153","10.100.5.154","10.100.5.155","10.100.5.156","10.100.5.157","10.100.5.158","10.100.5.159","10.100.5.160","10.100.5.161","10.100.5.162","10.100.5.163","10.100.5.164","10.100.5.165","10.100.5.166","10.100.5.167","10.100.5.168","10.100.5.169","10.100.5.170","10.100.5.171","10.100.5.172","10.100.5.173","10.100.5.174","10.100.5.175","10.100.5.176","10.100.5.177","10.100.5.178","10.100.5.179","10.100.5.180","10.100.5.181","10.100.5.182","10.100.5.183","10.100.5.184","10.100.5.185","10.100.5.186","10.100.5.187","10.100.5.188","10.100.5.189","10.100.5.190","10.100.5.191","10.100.5.192","10.100.5.193","10.100.5.194","10.100.5.195","10.100.5.196","10.100.5.197","10.100.5.198","10.100.5.199","10.100.5.200","10.100.5.201","10.100.5.202","10.100.5.203","10.100.5.204","10.100.5.205","10.100.5.206","10.100.5.207","10.100.5.208","10.100.5.209","10.100.5.210","10.100.5.211","10.100.5.212","10.100.5.213","10.100.5.214","10.100.5.215","10.100.5.216","10.100.5.217","10.100.5.218","10.100.5.219","10.100.5.220","10.100.5.221","10.100.5.222","10.100.5.223","10.100.5.224","10.100.5.225","10.100.5.226","10.100.5.227","10.100.5.228","10.100.5.229","10.100.5.230","10.100.5.231","10.100.5.232","10.100.5.233","10.100.5.234","10.100.5.235","10.100.5.236","10.100.5.237","10.100.5.238","10.100.5.239","10.100.5.240","10.100.5.241","10.100.5.242","10.100.5.243","10.100.5.244","10.100.5.245","10.100.5.246","10.100.5.247","10.100.5.248","10.100.5.249","10.100.5.250","10.100.5.251","10.100.5.252","10.100.5.253","10.100.5.254"]
     interval = "1m"
     timeout = "5s"
     version = 2
     #community=""


   [[inputs.snmp.field]]
    name = "hostname"
    oid = ".1.3.6.1.2.1.1.5.0"
    is_tag = true
   [[inputs.snmp.tags]]
    site = ""
    network = ""
   [[inputs.snmp.field]]
     name = "uptime"
     oid = "RFC1213-MIB::sysUpTime.0"

   [[inputs.snmp.field]]
     name = "cpu"
     oid = ".1.3.6.1.4.1.2021.11.10.0"

   [[inputs.snmp.field]]
     name = "total_mem"
     oid = ".1.3.6.1.4.1.2021.4.5.0"

   [[inputs.snmp.field]]
     name = "mem_used"
     oid = ".1.3.6.1.4.1.2021.4.6.0"

   [[inputs.snmp.field]]
     name = "5min_load"
     oid = ".1.3.6.1.4.1.2021.10.1.3.2"

   [[inputs.snmp.field]]
     name = "15min_loaad"
     oid = ".1.3.6.1.4.1.2021.10.1.3.3"

   [[inputs.snmp.table]]
     oid = "IF-MIB::ifTable"
     name = "interface"
     inherit_tags = ["hostname"]

   [[inputs.snmp.table.field]]
      oid = "IF-MIB::ifDescr"
      name = "ifDescr"
      is_tag = true

   [[inputs.snmp.table]]
    name = "hrStorage"
    oid = ".1.3.6.1.2.1.25.2.3"
    inherit_tags = ["hostname"]

   [[inputs.snmp.table.field]]
    name = "hrStorageDescr"
    oid = "HOST-RESOURCES-MIB::hrStorageDescr"
    is_tag = true

  [[outputs.influxdb_v2]]
  urls = [""]
  token = ""
  organization = ""
  bucket = ""



---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: telegraf
  namespace: telegraf
spec:
  replicas: 1 # Adjust the number of replicas as needed
  selector:
    matchLabels:
      app: telegraf
  template:
    metadata:
      labels:
        app: telegraf
    spec:
      containers:
        - name: telegraf
          image: telegraf:latest # Replace with the Telegraf image name and version
          volumeMounts:
            - name: config-volume
              mountPath: /etc/telegraf
            - name: mibs
              mountPath: /usr/share/snmp
      volumes:
        - name: config-volume
          configMap:
            name: telegraf-config
        - name: mibs
          hostPath:
            path: /Users/ponnathota/Documents/snmp_monitoring/telgraf/snmp
